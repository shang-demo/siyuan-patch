name: tmp

on:
  workflow_dispatch:
    # inputs:
    #   version:
    #     description: "release version/tag"
    #     required: true

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
      - name: test1
        run: |
          sudo apt install jq

          response=$(curl --request GET --url https://api.github.com/repos/${GITHUB_REPOSITORY}/actions/workflows --header 'Accept: application/vnd.github+json' --header 'Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' --header 'X-GitHub-Api-Version: 2022-11-28')

          androidId=$(echo "$response" | jq -r '.workflows | .[] | select(.path | contains("release-android.yml")) | .id')
          pcId=$(echo "$response" | jq -r '.workflows | .[] | select(.path | contains("release-pc.yml")) | .id')


          curl -X POST -H "Accept: application/vnd.github.v3+json" -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/repos/shang-demo/siyuan-patch/actions/workflows/${androidId}/dispatches" -d '{"ref": "main", "inputs": {"version": "3.0.4"}}'

          curl -X POST -H "Accept: application/vnd.github.v3+json" -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/repos/shang-demo/siyuan-patch/actions/workflows/${pcId}/dispatches" -d '{"ref": "main", "inputs": {"version": "3.0.4"}}'
